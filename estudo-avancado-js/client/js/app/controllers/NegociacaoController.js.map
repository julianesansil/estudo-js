{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["Negociacao","ListaNegociacoes","Mensagem","NegociacaoService","NegociacoesView","MensagemView","DataHelper","Bind","NegociacaoController","$","document","querySelector","bind","_form","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_ordemAtual","_service","_init","listarTodos","then","negociacoes","forEach","adicionar","negociacao","catch","texto","error","setInterval","importar","event","preventDefault","_criarNegociacao","mensagem","_limparFormulario","apagarTodos","coluna","inverterOrdem","ordenar","a","b","textoParaData","value","parseInt","parseFloat","reset","focus","negociacaoCtrl","currentNegociacaoCtrl"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["\r\nimport {Negociacao} from \"../models/Negociacao\";\r\nimport {ListaNegociacoes} from \"../models/ListaNegociacoes\";\r\nimport {Mensagem} from \"../models/Mensagem\";\r\n\r\nimport {NegociacaoService} from \"../services/NegociacaoService\";\r\nimport {NegociacoesView} from \"../views/NegociacoesView\";\r\nimport {MensagemView} from \"../views/MensagemView\";\r\n\r\nimport {DataHelper} from \"../helpers/DataHelper\";\r\nimport {Bind} from \"../helpers/Bind\";\r\n\r\n\r\nclass NegociacaoController {\r\n\r\n    constructor() {\r\n\r\n        let $ = document.querySelector.bind(document);\r\n\r\n        this._form = $(\".form\");\r\n        this._inputData = $(\"#data\");\r\n        this._inputQuantidade = $(\"#quantidade\");\r\n        this._inputValor = $(\"#valor\");\r\n\r\n        this._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($(\"#tabelaNegociacao\")), \"adicionar\", \"apagarTodos\", \"ordenar\", \"inverterOrdem\");\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($(\"#mensagem\")), \"texto\");\r\n\r\n        // this._listaNegociacoes = ProxyFactory.create(new ListaNegociacoes(), [\"adicionar\", \"apagarTodos\"],\r\n        //     (model) => {\r\n\r\n        //         this._negociacoesView.atualizar(model)\r\n        //     }\r\n        // );\r\n\r\n        this._ordemAtual = \"\";\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n    }\r\n\r\n    _init() {\r\n\r\n        this._service.listarTodos()\r\n            .then((negociacoes) => {\r\n\r\n                negociacoes.forEach(negociacao =>\r\n                    this._listaNegociacoes.adicionar(negociacao)\r\n                );\r\n            })\r\n            .catch(error => this._mensagem.texto = error);\r\n\r\n        setInterval(() => {\r\n            this.importar();\r\n        }, 3000);\r\n    }\r\n\r\n    adicionar(event) {\r\n\r\n        event.preventDefault();\r\n        let negociacao = this._criarNegociacao();\r\n\r\n        this._service.adicionar(negociacao)\r\n            .then((mensagem) => {\r\n\r\n                this._listaNegociacoes.adicionar(negociacao);\r\n                this._mensagem.texto = mensagem;\r\n                this._limparFormulario();\r\n            })\r\n            .catch(error => this._mensagem.texto = error);\r\n    }\r\n\r\n    apagarTodos() {\r\n\r\n        this._service.apagarTodos()\r\n            .then((mensagem) => {\r\n\r\n                this._listaNegociacoes.apagarTodos();\r\n                this._mensagem.texto = mensagem;\r\n            })\r\n            .catch(error => this._mensagem.texto = error);\r\n    }\r\n\r\n    importar() {\r\n\r\n        this._service.importar(this._listaNegociacoes.negociacoes)\r\n            .then((negociacoes) => {\r\n\r\n                negociacoes.forEach(negociacao =>\r\n                    this._listaNegociacoes.adicionar(negociacao)\r\n                );\r\n\r\n                // this._mensagem.texto = \"Negociações importadas com sucesso. o//\"\r\n            })\r\n            .catch(error => this._mensagem.texto = error);\r\n    }\r\n\r\n    ordenar(coluna) {\r\n\r\n        if (this._ordemAtual == coluna) {\r\n            this._listaNegociacoes.inverterOrdem();\r\n        } else {\r\n            this._listaNegociacoes.ordenar((a, b) => a[coluna] - b[coluna]);\r\n        }\r\n\r\n        this._ordemAtual = coluna;\r\n    }\r\n\r\n    _criarNegociacao() {\r\n\r\n        return new Negociacao(\r\n            DataHelper.textoParaData(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value)\r\n        );\r\n    }\r\n\r\n    _limparFormulario() {\r\n\r\n        this._form.reset();\r\n        this._inputData.focus();\r\n    }\r\n\r\n}\r\n\r\nlet negociacaoCtrl = new NegociacaoController();\r\n\r\nexport function currentNegociacaoCtrl() {\r\n\r\n    return negociacaoCtrl;\r\n}"]}